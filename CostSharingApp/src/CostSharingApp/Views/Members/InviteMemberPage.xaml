<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:CostSharingApp.ViewModels.Members"
             x:Class="CostSharingApp.Views.Members.InviteMemberPage"
             x:DataType="vm:InviteMemberViewModel"
             Title="{Binding Title}">

    <ScrollView Padding="16">
        <VerticalStackLayout Spacing="16">
            <!-- Error message -->
            <Label Text="{Binding ErrorMessage}"
                   TextColor="Red"
                   IsVisible="{Binding ErrorMessage, Converter={StaticResource StringIsNotNullOrEmptyConverter}}" />

            <!-- Instructions -->
            <Label Text="Invite a new member"
                   FontSize="18"
                   FontAttributes="Bold" />

            <Label Text="Enter the email address of the person you want to invite. If they already have an account, they'll be added immediately. Otherwise, they'll see this group when they sign up."
                   TextColor="{StaticResource Gray600}"
                   FontSize="14" />

            <!-- Email input -->
            <StackLayout Spacing="8">
                <Label Text="Email Address" FontAttributes="Bold" />
                <Entry Text="{Binding MemberEmail}"
                       Placeholder="friend@example.com"
                       Keyboard="Email"
                       ReturnType="Done" />
            </StackLayout>

            <!-- Send Email Invitation Option -->
            <Frame BorderColor="{StaticResource Primary}" 
                   BackgroundColor="#F0F4FF" 
                   Padding="12" 
                   CornerRadius="8" 
                   Margin="0,8,0,0">
                <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
                    <CheckBox Grid.Column="0" 
                              IsChecked="{Binding SendEmailInvite}" 
                              Color="{StaticResource Primary}"
                              VerticalOptions="Center" />
                    <VerticalStackLayout Grid.Column="1" Spacing="4" VerticalOptions="Center">
                        <Label Text="ðŸ“§ Send Email Invitation" FontAttributes="Bold" />
                        <Label Text="Send an invitation email via your Gmail account with instructions to join."
                               TextColor="{StaticResource Gray600}"
                               FontSize="12" />
                    </VerticalStackLayout>
                </Grid>
            </Frame>

            <!-- Info box -->
            <Frame BorderColor="{StaticResource Gray300}" Padding="12" CornerRadius="8" Margin="0,8,0,0">
                <HorizontalStackLayout Spacing="8">
                    <Label Text="â„¹ï¸" FontSize="20" />
                    <Label VerticalOptions="Center" TextColor="{StaticResource Gray600}">
                        <Label.FormattedText>
                            <FormattedString>
                                <Span Text="When they " />
                                <Span Text="sign in with this email" FontAttributes="Bold" />
                                <Span Text=", they'll automatically see this group." />
                            </FormattedString>
                        </Label.FormattedText>
                    </Label>
                </HorizontalStackLayout>
            </Frame>

            <!-- Action buttons -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="8" Margin="0,16,0,0">
                <Button Grid.Column="0"
                        Text="Cancel"
                        Command="{Binding CancelCommand}"
                        BackgroundColor="{StaticResource Gray300}"
                        TextColor="{StaticResource Gray900}" />

                <Button Grid.Column="1"
                        Text="Invite Member"
                        Command="{Binding InviteMemberCommand}"
                        IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}" />
            </Grid>

            <!-- Loading indicator -->
            <ActivityIndicator IsRunning="{Binding IsBusy}"
                              IsVisible="{Binding IsBusy}"
                              Color="{StaticResource Primary}"
                              HorizontalOptions="Center" />
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
