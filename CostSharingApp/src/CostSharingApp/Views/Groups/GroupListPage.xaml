<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:CostSharingApp.ViewModels.Groups"
             xmlns:models="clr-namespace:CostSharing.Core.Models;assembly=CostSharing.Core"
             x:Class="CostSharingApp.Views.Groups.GroupListPage"
             x:DataType="vm:GroupListViewModel"
             Title="{Binding Title}">

    <Grid RowDefinitions="Auto,*" Padding="16">
        <!-- Error message -->
        <Label Grid.Row="0"
               Text="{Binding ErrorMessage}"
               TextColor="Red"
               IsVisible="{Binding ErrorMessage, Converter={StaticResource StringIsNotNullOrEmptyConverter}}"
               Margin="0,0,0,8" />

        <!-- Groups list -->
        <RefreshView Grid.Row="1"
                     IsRefreshing="{Binding IsBusy}"
                     Command="{Binding LoadGroupsCommand}">
            <CollectionView ItemsSource="{Binding Groups}"
                            SelectionMode="None">
                <CollectionView.EmptyView>
                    <StackLayout Padding="20" VerticalOptions="Center">
                        <Label Text="No groups yet"
                               FontSize="20"
                               FontAttributes="Bold"
                               HorizontalTextAlignment="Center"
                               Margin="0,0,0,8" />
                        <Label Text="Create your first group to start sharing costs"
                               HorizontalTextAlignment="Center"
                               TextColor="{StaticResource Gray500}" />
                    </StackLayout>
                </CollectionView.EmptyView>

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Group">
                        <Border Margin="0,0,0,8" Padding="12" StrokeShape="RoundRectangle 8" Shadow="{Shadow Brush=Black, Offset='0,2', Radius=4, Opacity=0.3}">
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:GroupListViewModel}}, Path=SelectGroupCommand}"
                                                      CommandParameter="{Binding .}" />
                            </Border.GestureRecognizers>
                            <Grid ColumnDefinitions="*,Auto,Auto">
                                <StackLayout Grid.Column="0">
                                    <Label Text="{Binding Name}"
                                           FontSize="18"
                                           FontAttributes="Bold" />
                                    <Label Text="{Binding Currency}"
                                           TextColor="{StaticResource Gray600}"
                                           FontSize="14" />
                                    <HorizontalStackLayout Spacing="8">
                                        <Label Text="{Binding UpdatedAt, StringFormat='Updated: {0:MMM dd, yyyy}'}"
                                               TextColor="{StaticResource Gray500}"
                                               FontSize="12"
                                               VerticalOptions="Center" />
                                        <!-- Sync Status Badge -->
                                        <Border Padding="6,2"
                                                BackgroundColor="{StaticResource Primary}"
                                                StrokeShape="RoundRectangle 8"
                                                IsVisible="{Binding DriveFolderId, Converter={StaticResource StringIsNotNullOrEmptyConverter}}">
                                            <HorizontalStackLayout Spacing="4">
                                                <Label Text="â˜"
                                                       FontSize="10"
                                                       TextColor="White"
                                                       VerticalOptions="Center" />
                                                <Label Text="Synced"
                                                       FontSize="10"
                                                       TextColor="White"
                                                       VerticalOptions="Center" />
                                            </HorizontalStackLayout>
                                        </Border>
                                    </HorizontalStackLayout>
                                </StackLayout>
                                <Image Grid.Column="2"
                                       Source="chevron_right.png"
                                       WidthRequest="24"
                                       HeightRequest="24"
                                       VerticalOptions="Center" />
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>

        <!-- Create group button -->
        <Button Grid.Row="1"
                Text="Create Group"
                Command="{Binding CreateGroupCommand}"
                VerticalOptions="End"
                HorizontalOptions="Center"
                Margin="0,0,0,16"
                WidthRequest="200" />
    </Grid>
</ContentPage>
